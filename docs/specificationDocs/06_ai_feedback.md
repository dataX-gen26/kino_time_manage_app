# 機能仕様書: AIによるフィードバック

- **ID**: 06
- **機能名**: AIによる1日の振り返り
- **関連要件**: AI分析機能
- **優先度**: 推奨

## 1. 機能概要

その日の「予定」と「実績」のデータを基に、Gemini APIを利用して生産性に関するフィードバックと翌日のアクションプランを生成し、ユーザーに提示する。

## 2. 仕様詳細

### 2.1. 実行フロー

1.  ユーザーがメイン画面またはダッシュボード画面にある「今日の振り返り (AI)」ボタンをクリックする。
2.  フロントエンドは、表示中の日付の予定データと実績データを整形し、バックエンドのAI分析APIに送信する。
3.  バックエンドは、受け取ったデータを元に、Gemini APIに送信するためのプロンプトを生成する。
4.  **プロンプトの構成例**: 
    - **役割設定**: 「あなたは優秀な生産性向上コンサルタントです。」
    - **コンテキスト**: 「以下のデータは、あるユーザーの1日のGoogleカレンダーの予定と、実際に行動した実績の記録です。」
    - **データ**: 
        - 予定: `[{title: '会議A', start: '09:00', end: '10:00'}, ...]`
        - 実績: `[{content: '会議A', category: '会議', start: '09:00', end: '10:15', had_problem: true}, ...]`
    - **指示**: 「このデータに基づいて、以下の形式でフィードバックとアクションプランを生成してください。」
    - **出力形式の指定**: 
        - **[今日のハイライト]**: 良かった点、計画通りに進んだ点など。
        - **[改善点]**: 計画との乖離、問題フラグが立った点、カテゴリの偏りなど。
        - **[明日へのアクションプラン]**: 具体的な改善行動の提案。
5.  バックエンドはGemini APIからのレスポンス（マークダウン形式など）をフロントエンドに返す。
6.  フロントエンドは、受け取ったフィードバックをモーダルウィンドウなどで見やすく表示する。

### 2.2. データ整形

- フロントエンドは、APIに送信する前に、予定と実績のデータを簡潔なテキスト形式に変換する。
- 実績データには、内容、カテゴリ、時間、問題フラグの有無を含める。

## 3. APIエンドポイント

- `POST /api/v1/ai/daily_review`: その日のデータに基づいたAIフィードバックを要求する。

## 4. データモデル

- AIによる分析結果は永続化せず、ボタンクリックの都度、リアルタイムに生成する。

## 5. その他

- Gemini APIキーはバックエンドの環境変数として厳重に管理する。
- プロンプトの内容は、より質の高いフィードバックが得られるように継続的に改善を行う。
- APIからのレスポンスが不適切な内容を含まないよう、後処理（フィルタリングなど）を検討する場合がある。
