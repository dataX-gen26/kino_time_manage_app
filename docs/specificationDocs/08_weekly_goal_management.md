# 週次目標管理機能 仕様書

## 1. 概要

本ドキュメントは、ユーザーが週次目標を設定し、日々の実績記入時にその進捗を記録し、週の終わりに目標達成度を振り返る機能の具体的な仕様を定義する。

## 2. 機能詳細

### 2.1. 週次目標の設定と表示

- **目的**: ユーザーが週の初めに具体的な目標を設定し、それをアプリ内で常に意識できるようにする。
- **UI**: 
    - メイン画面（日次実績記入画面）のヘッダー部分、または専用の「週次目標」ページから設定・編集モーダルを開けるようにする。
    - モーダルには、目標のタイトル、詳細（任意）、目標期間（自動で週の開始日と終了日を設定、手動調整も可能）を入力するフィールドを設ける。
- **データ項目**: 
    - `weekly_goal_id` (PK)
    - `user_id` (FK)
    - `start_date` (週の開始日)
    - `end_date` (週の終了日)
    - `title` (目標タイトル)
    - `description` (目標詳細、任意)
    - `status` (例: `active`, `completed`, `archived`)
- **バリデーション**: 目標タイトルは必須。期間は重複しないように制御。

### 2.2. 日次実績記入時の週次目標進捗記入

- **目的**: 日々の活動が週次目標にどのように貢献したかを記録し、目標達成への意識を高める。
- **UI**: 
    - 実績入力モーダル（`ActualFormModal`）内に、「週次目標への貢献」といったセクションを設ける。
    - 現在アクティブな週次目標が表示され、その目標に対する進捗内容をテキストエリアで記入できるようにする。
    - 記入内容は、その日の実績（`actual`）と紐付けることも可能にする（`actual_id`を`weekly_goal_progresses`に保存）。
- **データ項目**: 
    - `weekly_goal_progress_id` (PK)
    - `weekly_goal_id` (FK)
    - `actual_id` (FK, 任意。どの日次実績に関連するか)
    - `progress_date` (進捗を記録した日)
    - `content` (進捗内容テキスト)
- **バリデーション**: 進捗内容は任意。

### 2.3. 週次振り返り機能

- **目的**: 週の終わりに、設定した目標に対する進捗を一覧で確認し、自己評価やAIからのフィードバックを通じて、次週の計画に活かす。
- **UI**: 
    - 専用の「週次振り返り」ページを設ける。
    - 選択した週の週次目標と、それに対する日々の進捗記入内容を時系列で一覧表示する。
    - AIによるフィードバックボタンを設置し、クリックするとその週の目標と進捗内容を基にAIが分析・提案を行う。
    - ユーザーが自己評価やコメントを記入できるテキストエリアを設ける。
- **AI連携**: 
    - 週次目標のタイトル、詳細、および記録された全ての`weekly_goal_progresses.content`をGemini APIに送信。
    - AIには、目標達成度、課題、次週へのアドバイスなどをフィードバックとして生成させる。
- **データ項目**: 
    - 週次目標データ (`weekly_goals`テーブルから取得)
    - 週次目標進捗データ (`weekly_goal_progresses`テーブルから取得)
    - AIフィードバック結果 (一時的な表示、または`weekly_goals`テーブルに保存することも検討)
    - ユーザーの自己評価/コメント (これも`weekly_goals`テーブルに保存)

## 3. UI/UX考慮事項

- 週次目標の設定は、ユーザーが迷わないよう、明確な導線を設ける。
- 日次実績記入時の進捗記入は、既存のフローを妨げないよう、シンプルかつ直感的なUIにする。
- 週次振り返り画面は、情報が見やすく、ユーザーが内省しやすいレイアウトにする。

## 4. APIエンドポイント (バックエンド設計書と連携)

- `GET /api/v1/weekly_goals`: 週次目標一覧取得
- `POST /api/v1/weekly_goals`: 週次目標作成
- `GET /api/v1/weekly_goals/:id`: 週次目標詳細取得
- `PUT /api/v1/weekly_goals/:id`: 週次目標更新
- `DELETE /api/v1/weekly_goals/:id`: 週次目標削除
- `POST /api/v1/weekly_goals/:id/progresses`: 週次目標進捗記録
- `GET /api/v1/weekly_goals/:id/progresses`: 週次目標進捗一覧取得

## 5. データベース設計 (データベース設計書と連携)

- `weekly_goals` テーブル
- `weekly_goal_progresses` テーブル

詳細は[07_database_design.md](../07_database_design.md)を参照。